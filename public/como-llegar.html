<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C贸mo Llegar | Pablo & Cris</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'></text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&family=Montserrat:wght@300;400;500;600&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/sidebar.css">
  <!-- GSAP + ScrollTrigger -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  <style>
    /* ============================================
       CANVAS SCROLLYTELLING STYLES
    ============================================= */
    
    /* Loading Screen */
    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--color-bg);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.6s ease, visibility 0.6s ease;
    }
    
    .loader.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }
    
    .loader__spinner {
      width: 60px;
      height: 60px;
      border: 3px solid var(--color-bg-dark);
      border-top-color: var(--color-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loader__text {
      margin-top: 1.5rem;
      font-family: var(--font-title);
      font-size: 1.5rem;
      color: var(--color-text);
      letter-spacing: 0.05em;
    }
    
    .loader__progress {
      margin-top: 0.5rem;
      font-family: var(--font-body);
      font-size: 0.9rem;
      color: var(--color-text-light);
    }
    
    /* Scroll Container */
    .scroll-container {
      position: relative;
      height: 500vh; /* Long scroll distance for smooth animation */
      width: 100%;
    }
    
    /* Fixed Canvas */
    .canvas-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    
    #frameCanvas {
      display: block;
      width: 100%;
      height: 100%;
    }
    
    /* Overlay UI - Minimalista */
    .location-overlay {
      position: fixed;
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.6rem 1rem 0.6rem 0.75rem;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 999px;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    
    .location-overlay.hidden {
      opacity: 0;
      pointer-events: none;
      transform: translateY(10px);
    }
    
    /* Church Overlay - Bottom Left */
    .overlay--iglesia {
      bottom: 8%;
      left: 1.5rem;
    }
    
    /* Finca Overlay - Bottom Right */
    .overlay--finca {
      bottom: 8%;
      right: 1.5rem;
    }
    
    .overlay__icon {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.9);
      border-radius: 50%;
      color: var(--color-primary-dark);
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    
    .overlay__text {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    
    .overlay__title {
      font-family: var(--font-body);
      font-size: 0.7rem;
      font-weight: 500;
      color: rgba(255,255,255,0.7);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    
    .overlay__name {
      font-family: var(--font-title);
      font-size: 1.05rem;
      font-weight: 500;
      color: var(--color-white);
      line-height: 1.2;
    }
    
    .location-overlay:hover {
      background: rgba(255,255,255,0.22);
      transform: translateY(-2px);
    }
    
    /* Scroll Indicator - Solo flecha minimalista */
    .scroll-indicator {
      position: fixed;
      bottom: 25px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255,255,255,0.6);
      opacity: 1;
      transition: opacity 0.5s ease;
    }
    
    .scroll-indicator.hidden {
      opacity: 0;
      pointer-events: none;
    }
    
    .scroll-indicator__arrow {
      font-size: 1rem;
      animation: float 2s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); opacity: 0.6; }
      50% { transform: translateY(6px); opacity: 1; }
    }
    
    /* Progress Bar */
    .progress-bar {
      position: fixed;
      top: var(--header-height);
      left: 0;
      width: 0%;
      height: 3px;
      background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
      z-index: 100;
      transition: width 0.1s linear;
    }
    
    /* Navbar stays on top - transparent over canvas */
    .header {
      z-index: 1000 !important;
      background: transparent !important;
      backdrop-filter: none;
    }
    
    .header .nav__logo,
    .header .nav__link,
    .header .nav__toggle i {
      color: var(--color-white) !important;
      text-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    
    .header .nav__link:hover,
    .header .nav__link.active {
      color: var(--color-white) !important;
      opacity: 0.8;
    }
    
    /* Footer styling */
    .footer-section {
      position: relative;
      z-index: 20;
      background: var(--color-bg);
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      .overlay--iglesia,
      .overlay--finca {
        left: 1rem;
        right: 1rem;
        bottom: 6%;
      }
      
      .scroll-container {
        height: 400vh;
      }
      
      .overlay__name {
        font-size: 0.95rem;
      }
    }
  </style>
</head>

<body>
  <!-- Loading Screen -->
  <div class="loader" id="loader">
    <div class="loader__spinner"></div>
    <p class="loader__text">Preparando el viaje...</p>
    <p class="loader__progress" id="loaderProgress">0%</p>
  </div>

  <!-- Progress Bar -->
  <div class="progress-bar" id="progressBar"></div>

  <header class="header" id="header">
    <nav class="nav container">
      <a href="index.html" class="nav__logo">C & P</a>
      <div class="nav__menu" id="nav-menu">
        <ul class="nav__list">
          <li class="nav__item"><a href="index.html" class="nav__link">Inicio</a></li>
          <li class="nav__item"><a href="confirmar.html" class="nav__link">Confirmar</a></li>
          <li class="nav__item"><a href="como-llegar.html" class="nav__link active">C贸mo Llegar</a></li>
          <li class="nav__item"><a href="preboda.html" class="nav__link">Preboda</a></li>
          <li class="nav__item"><a href="regalos.html" class="nav__link">Lista de Bodas</a></li>
        </ul>
        <div class="nav__close" id="nav-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="nav__toggle" id="nav-toggle"><i class="fas fa-bars"></i></div>
    </nav>
  </header>

  <main class="main">
    <!-- Canvas Container -->
    <div class="canvas-wrapper">
      <canvas id="frameCanvas"></canvas>
    </div>

    <!-- Scroll Container (creates the scroll distance) -->
    <div class="scroll-container" id="scrollContainer">
      
      <!-- Church Overlay (Start) -->
      <a class="location-overlay overlay--iglesia" id="overlayIglesia" href="https://maps.google.com?q=Iglesia+de+San+Pedro" target="_blank" rel="noopener">
        <span class="overlay__icon"><i class="fas fa-map-marker-alt"></i></span>
        <span class="overlay__text">
          <span class="overlay__title">Ceremonia</span>
          <span class="overlay__name">Iglesia de San Pedro</span>
        </span>
      </a>

      <!-- Finca Overlay (End) -->
      <a class="location-overlay overlay--finca hidden" id="overlayFinca" href="https://maps.google.com?q=Finca+El+Olivar" target="_blank" rel="noopener">
        <span class="overlay__icon"><i class="fas fa-map-marker-alt"></i></span>
        <span class="overlay__text">
          <span class="overlay__title">Celebraci贸n</span>
          <span class="overlay__name">Finca El Olivar</span>
        </span>
      </a>

      <!-- Scroll Indicator -->
      <div class="scroll-indicator" id="scrollIndicator">
        <i class="fas fa-chevron-down scroll-indicator__arrow"></i>
      </div>
      
    </div>
  </main>

  <script src="js/script.js"></script>
  <script>
    // ============================================
    // CANVAS SCROLLYTELLING - IMAGE SEQUENCE
    // ============================================
    
    (function() {
      'use strict';
      
      // ========== CONFIGURATION ==========
      const frameCount = 161;  // Total number of frames
      const framePath = 'images/video_trayecto/ezgif-frame-';  // Path pattern
      const frameExtension = '.jpg';
      
      // Pad frame number to 3 digits (001, 002, etc.)
      const getFramePath = (index) => {
        const frameNumber = String(index + 1).padStart(3, '0');
        return `${framePath}${frameNumber}${frameExtension}`;
      };
      
      // ========== DOM ELEMENTS ==========
      const canvas = document.getElementById('frameCanvas');
      const ctx = canvas.getContext('2d');
      const loader = document.getElementById('loader');
      const loaderProgress = document.getElementById('loaderProgress');
      const progressBar = document.getElementById('progressBar');
      const overlayIglesia = document.getElementById('overlayIglesia');
      const overlayFinca = document.getElementById('overlayFinca');
      const scrollIndicator = document.getElementById('scrollIndicator');
      const scrollContainer = document.getElementById('scrollContainer');
      
      // ========== STATE ==========
      const images = [];
      let currentFrame = 0;
      let imagesLoaded = 0;
      let isReady = false;
      
      // Auto-scroll state
      let autoScrollActive = false;
      let autoScrollRAF = null;
      let scrollDirection = 1; // 1 = down, -1 = up
      let lastScrollY = 0;
      
      // ========== CANVAS RESIZE (object-fit: cover) ==========
      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        if (isReady && images[currentFrame]) {
          drawFrame(currentFrame);
        }
      }
      
      // Draw frame with cover behavior
      function drawFrame(frameIndex) {
        const img = images[frameIndex];
        if (!img || !img.complete) return;
        
        const canvasRatio = canvas.width / canvas.height;
        const imgRatio = img.width / img.height;
        
        let drawWidth, drawHeight, offsetX, offsetY;
        
        if (imgRatio > canvasRatio) {
          // Image is wider - fit by height, crop sides
          drawHeight = canvas.height;
          drawWidth = img.width * (canvas.height / img.height);
          offsetX = (canvas.width - drawWidth) / 2;
          offsetY = 0;
        } else {
          // Image is taller - fit by width, crop top/bottom
          drawWidth = canvas.width;
          drawHeight = img.height * (canvas.width / img.width);
          offsetX = 0;
          offsetY = (canvas.height - drawHeight) / 2;
        }
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
      }
      
      // ========== PRELOAD IMAGES ==========
      function preloadImages() {
        return new Promise((resolve) => {
          for (let i = 0; i < frameCount; i++) {
            const img = new Image();
            img.src = getFramePath(i);
            
            img.onload = () => {
              imagesLoaded++;
              const progress = Math.round((imagesLoaded / frameCount) * 100);
              loaderProgress.textContent = `${progress}%`;
              
              if (imagesLoaded === frameCount) {
                resolve();
              }
            };
            
            img.onerror = () => {
              console.warn(`Failed to load frame: ${getFramePath(i)}`);
              imagesLoaded++;
              if (imagesLoaded === frameCount) {
                resolve();
              }
            };
            
            images[i] = img;
          }
        });
      }
      
      // ========== SCROLL ANIMATION SETUP ==========
      function initScrollAnimation() {
        gsap.registerPlugin(ScrollTrigger);
        
        // Main timeline for frame sequence
        const frameAnimation = { frame: 0 };
        
        gsap.to(frameAnimation, {
          frame: frameCount - 1,
          snap: 'frame',
          ease: 'none',
          scrollTrigger: {
            trigger: scrollContainer,
            start: 'top top',
            end: 'bottom bottom',
            scrub: 0.5, // Smooth scrubbing
            onUpdate: (self) => {
              const progress = self.progress;
              
              // Update current frame
              currentFrame = Math.round(frameAnimation.frame);
              drawFrame(currentFrame);
              
              // Update progress bar
              progressBar.style.width = `${progress * 100}%`;
              
              // Handle overlay visibility
              if (progress < 0.1) {
                // Show church overlay at start
                overlayIglesia.classList.remove('hidden');
                overlayFinca.classList.add('hidden');
                scrollIndicator.classList.remove('hidden');
              } else if (progress > 0.9) {
                // Show finca overlay at end
                overlayIglesia.classList.add('hidden');
                overlayFinca.classList.remove('hidden');
                scrollIndicator.classList.add('hidden');
              } else {
                // Hide both during journey
                overlayIglesia.classList.add('hidden');
                overlayFinca.classList.add('hidden');
                scrollIndicator.classList.add('hidden');
              }
            }
          }
        });
      }
      
      // ========== AUTO-SCROLL ==========
      function startAutoScroll(direction = 1) {
        if (autoScrollActive) return;
        
        autoScrollActive = true;
        scrollDirection = direction;
        const scrollSpeed = 4; // Pixels per frame (ajustable)
        
        function autoScrollFrame() {
          if (!autoScrollActive) return;
          
          const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          
          // Si llegamos al l铆mite en cualquier direcci贸n, detenemos
          if ((scrollDirection > 0 && currentScroll >= maxScroll) || 
              (scrollDirection < 0 && currentScroll <= 0)) {
            stopAutoScroll();
            return;
          }
          
          // Scroll suave en la direcci贸n actual
          window.scrollBy({
            top: scrollSpeed * scrollDirection,
            behavior: 'instant' // Instant para suavidad frame-by-frame
          });
          
          autoScrollRAF = requestAnimationFrame(autoScrollFrame);
        }
        
        autoScrollRAF = requestAnimationFrame(autoScrollFrame);
      }
      
      function stopAutoScroll() {
        autoScrollActive = false;
        if (autoScrollRAF) {
          cancelAnimationFrame(autoScrollRAF);
          autoScrollRAF = null;
        }
      }
      
      // ========== USER INTERACTION DETECTION ==========
      function setupAutoScrollTriggers() {
        let userIsInteracting = false;
        
        // Detectar scroll del usuario y su direcci贸n - activar auto-scroll inmediatamente
        window.addEventListener('scroll', () => {
          const currentScrollY = window.pageYOffset || document.documentElement.scrollTop;
          
          // Detectar direcci贸n del scroll
          if (currentScrollY !== lastScrollY) {
            scrollDirection = currentScrollY > lastScrollY ? 1 : -1;
            lastScrollY = currentScrollY;
            
            // Si el usuario NO est谩 interactuando f铆sicamente, activar auto-scroll
            if (!userIsInteracting && !autoScrollActive) {
              const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
              const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
              
              if (currentScroll > 0 && currentScroll < maxScroll) {
                startAutoScroll(scrollDirection);
              }
            }
          }
        }, { passive: true });
        
        // Marcar que el usuario est谩 interactuando f铆sicamente
        const startInteractionEvents = ['wheel', 'touchstart', 'mousedown', 'keydown'];
        
        startInteractionEvents.forEach(event => {
          window.addEventListener(event, () => {
            userIsInteracting = true;
            if (autoScrollActive) {
              stopAutoScroll();
            }
          }, { passive: true });
        });
        
        // Marcar que el usuario dej贸 de interactuar f铆sicamente
        const endInteractionEvents = ['wheel', 'touchend', 'mouseup', 'keyup'];
        
        endInteractionEvents.forEach(event => {
          window.addEventListener(event, () => {
            userIsInteracting = false;
          }, { passive: true });
        });
        
        // Para touchmove, detectar direcci贸n pero no detener auto-scroll si no hay touch activo
        let touchStartY = 0;
        window.addEventListener('touchstart', (e) => {
          touchStartY = e.touches[0].clientY;
        }, { passive: true });
        
        window.addEventListener('touchmove', (e) => {
          const touchY = e.touches[0].clientY;
          scrollDirection = touchY < touchStartY ? 1 : -1;
          touchStartY = touchY;
        }, { passive: true });
      }
      
      // ========== INITIALIZE ==========
      async function init() {
        // Set initial canvas size
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // Preload all frames
        await preloadImages();
        
        // Mark as ready
        isReady = true;
        
        // Draw first frame
        drawFrame(0);
        
        // Hide loader with animation
        loader.classList.add('hidden');
        
        // Initialize scroll animation
        initScrollAnimation();
        
        // Setup auto-scroll triggers
        setupAutoScrollTriggers();
      }
      
      // Start when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
      
    })();
  </script>
</body>

</html>